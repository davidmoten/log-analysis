<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>log-analysis3</title>
<link href="layout.css" rel="stylesheet" type="text/css">
<!--[if lte IE 8]><script language="javascript" type="text/javascript" src="../excanvas.min.js"></script><![endif]-->
<script language="javascript" type="text/javascript"
	src="js/flot/jquery.js"></script>
<script language="javascript" type="text/javascript"
	src="js/flot/jquery.flot.js"></script>

<script language="javascript" type="text/javascript"
        src="js/flot/jquery.flot.time.js"></script>

<link rel="stylesheet"
	href="http://code.jquery.com/ui/1.9.2/themes/base/jquery-ui.css" />
<!-- <script src="http://code.jquery.com/jquery-1.8.3.js"></script> -->
<script src="http://code.jquery.com/ui/1.9.2/jquery-ui.js"></script>
</head>
<body>

	<div id="graph" style="width:1200px;height:400px;"></div>
	<div id="error"></div>

	<script type="text/javascript">
$(function () {

	function getURLParameter(name) {
        return decodeURIComponent(
            (RegExp(name + '=' + '(.+?)(&|$)').exec(location.search)||[,null])[1]
        );
    }
	
	function getAbsolutePath() {
        var loc = window.location;
        var pathName = loc.pathname.substring(0, loc.pathname.lastIndexOf('/') + 1);
        return loc.href.substring(0, loc.href.length - ((loc.pathname + loc.search + loc.hash).length - pathName.length));
    }
	
	function onDataReceived(series) {
	   	console.log(series);
	   	//series.lines = { show: true, steps: true, fill: true };
	   	series.bars = { show: true, align: "center", barWidth: 60000};
	   	series.points = { show: true };
		var options = {
				xaxis: {
			   	    mode: "time",
			   	    timeformat: "%H:%M"
			   	}
		};
	   	$.plot($("#graph"), [ series
//	                                {
//	                                    data: [[1,2],[5,7],[9,11]],
//	                                    bars: { show: true }
//	                                }
	                            ], options);
	     
	}
	
	var now = new Date().getTime();
	var sql = "select logTimestamp, specialNumber as value from Dummy where specialNumber is not null order by logTimestamp";
	sql = sql.replace(" ","%20");
	var startTime = now - 3600000;
	var interval = 60000;
	var buckets = 60;
	var metric = "MEAN";
	var dataurl =  "data?sql="+sql+"&start=" + startTime + "&interval="+ interval + "&buckets="+buckets+"&metric="+metric;
	console.log("dataurl=" + dataurl);
	$.ajax({
        url: dataurl,
        method: 'GET',
        dataType: 'json',
        success: onDataReceived,
        error: function (request, textStatus, errorThrown) {
        	console.log(errorThrown);
        	$("#error").text(errorThrown);
        },
        timeout: 60000
    });
})
    
  	</script>
</body>
</html>
